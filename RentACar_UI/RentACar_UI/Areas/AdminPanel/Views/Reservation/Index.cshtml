@using RentACar_UI.Areas.AdminPanel.Models;
@model ReservationIndexViewModel
@{
    Layout = "/Areas/AdminPanel/Views/Shared/_LayoutAdmin.cshtml";
}
@section customCss{
    <link rel="stylesheet" href="~/adminPanel/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/adminPanel/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/adminPanel/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
}

@section customScripts{
    <script src="~/adminPanel/plugins/jquery/jquery.min.js"></script>
    <script src="~/adminPanel/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/adminPanel/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/adminPanel/plugins/jszip/jszip.min.js"></script>
    <script src="~/adminPanel/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/adminPanel/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/adminPanel/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/adminPanel/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // DataTable'ı initialize et
        $("#tblReservations").DataTable({
            "paging": true,
            "lengthChange": false,
            "searching": false,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
        });

        // Silme butonu tıklama olayı
        $(document).on("click", ".btnDelete", function () {
            var rsrvID = $(this).attr("ReservationID");
            var tr = $(this).parent().parent();
            Swal.fire({
                title: "Ürün Silinecek",
                text: "Emin misiniz",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Sil"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: "/AdminPanel/Reservation/DeleteReservation/" + rsrvID,
                        method: "post",
                        success: function (response) {
                            if (response.result) {
                                Swal.fire({
                                    title: "Başarılı",
                                    text: response.message,
                                    icon: "success",
                                    confirmButtonColor: "#3085d6",
                                    cancelButtonColor: "#d33",
                                    confirmButtonText: "Kapat"
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        $(tr).remove();
                                    }
                                });
                            }
                            else {
                                Swal.fire({
                                    position: "top-end",
                                    icon: "error",
                                    title: response.message,
                                    showConfirmButton: false,
                                    timer: 1500
                                });
                            }
                        }
                    });
                }
            });
        });

        // Checkbox değişim olayı
        $(document).on("change", ".chkReservationOn", function () {
            var rsrvID = $(this).attr("ReservationID");
            var isChecked = $(this).is(":checked");
            var model = {
                ReservationID: rsrvID,
                ReservationOn: isChecked
            };

            $.ajax({
                url: "/AdminPanel/Reservation/EditReservation",
                method: "post",
                datatype: "json",
                data: { dto: model },
                success: function (response) {
                    if (response.result) {
                        Swal.fire({
                            title: "Başarılı",
                            text: response.message,
                            icon: "success",
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            confirmButtonText: "Kapat"
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $("#divEditReservation").modal("hide");
                                window.location.reload();
                            }
                        });
                    }
                    else {
                        Swal.fire({
                            position: "top-end",
                            icon: "error",
                            title: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        });
                    }
                }
            });
        });
    });
</script>

<div class="row">
    <div class="card col-12">
        <div class="card-header">
            <h3 class="card-title">Kayıtlı Tüm Rezervasyonlar</h3>
        </div>
        <!-- /.card-header -->
        <div class="card-body">
            <table id="tblReservations" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Araç Markası</th>
                        <th>Araç Modeli</th>
                        <th>Üye Adı - Üye Soyadı</th>
                        <th>Üye Email</th>
                        <th>Üye Telefon Numarası</th>
                        <th>Rezervasyon Başlangıç Tarihi</th>
                        <th>Rezervasyon Bitiş Tarihi</th>
                        <th>Şehir</th>
                        <th>İlçe</th>
                        <th>Aktif mi?</th>
                        <th>Sil</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Reservations)
                    {
                        <tr>
                            <td>@item.VehicleBrand</td>
                            <td>@item.VehicleModel</td>
                            <td>@item.CustomerName - @item.CustomerLastName</td>
                            <td>@item.CustomerEmail</td>
                            <td>@item.CustomerPhoneNumber</td>
                            <td>@item.ReservationStart</td>
                            <td>@item.ReservationFinish</td>
                            <td>@item.CityName</td>
                            <td>@item.District</td>
                            <td>
                                <span class="reservationStatus" data-reservation-id="@item.ReservationID" data-reservation-status="@item.ReservationOn">
                                    @if (item.ReservationOn)
                                    {
                                        <span class="badge badge-success">Evet</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-danger">Hayır</span>
                                    }
                                </span>
                                <input type="checkbox" class="chkReservationOn" ReservationID="@item.ReservationID" @(item.ReservationOn ? "checked" : "") />
                            </td>

                            <td>
                                <button ReservationID="@item.ReservationID" class="btn btn-danger btnDelete">
                                    Sil
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- /.card-body -->
    </div>
</div>

